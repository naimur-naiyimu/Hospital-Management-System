{% extends 'base.html' %}
{% load static %}
{% block title %}Details Patient{% endblock %}
{% block content %}
  <div class="container mt-4">
    <h1>Patient Details</h1>
    <div class="row">
      <div class="col-md-4 ">
        <h1 class="card-title" style="font-size: 24px;"><strong>Full Name:</strong>{{ patient.full_name }}</h1>
        <p class="card-text"><strong>Gender:</strong> {{ patient.get_gender_display }}</p>
        <p class="card-text"><strong>Date of Birth:</strong> {{ patient.date_of_birth }}</p>
        <p class="card-text"><strong>Blood Group:</strong> {{ patient.blood_group }}</p>
        <p class="card-text"><strong>Contact:</strong> {{ patient.contact_number }}</p>
        <p class="card-text"><strong>Address:</strong> {{ patient.address }}</p>
        <hr>
        {% if patient.admission_date %}
        <p class="card-text"><strong>Allocated Bed:</strong> Bed No.{{ patient.allocated_bed.bed_number }} - Ward: {{ patient.allocated_bed.ward.ward_number }}</p>
        <p class="card-text"><strong>Admission Date:</strong> {{ patient.admission_date }}</p>
        <p class="card-text"><strong>Release Date:</strong> {{ patient.release_date }}</p>
        {% endif %}
        <div class="col-md-4 mt-3">
        {% if user.user_type == 0  %}
        {% comment %} <a href="{% url 'administrations:appointment-create' %}" class="btn btn-primary">Create an Appointment</a> {% endcomment %}
        <a href="{% url 'patient:patient-update' patient.pk %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-edit"></i></a>
        <a href="{% url 'patient:patient-delete' patient.pk %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-trash"></i></a>
        {% endif %}
        </div>
      </div>
      <div class="col-md-4 mt-2">
          <div class="emergency-contact-section">
            <p class="card-text" style="font-size: 24px;">Emergency Contact:</p>
            <p class="card-text"><strong>Relation with Patient:</strong> {{ patient.relation_with_patient }}</p>
            <p class="card-text"><strong>Name:</strong> {{ patient.emergency_full_name }}</p>
            <p class="card-text"><strong>Gender:</strong> {{ patient.get_emergency_gender_display }}</p>
            <p class="card-text"><strong>Blood Group:</strong> {{ patient.emergency_blood_group }}</p>
            <p class="card-text"><strong>Contact:</strong> {{ patient.emergency_contact_number }}</p>
            <p class="card-text"><strong>Address:</strong> {{ patient.emergency_address }}</p>
          </div>
      </div>
    </div>
    </div>
    <!-- Display patient's appointments -->
    <h2>Appointments</h2>
<table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>#</th>
        <th>Doctor</th>
        <th>Appointment Date</th>
        <th>Purpose</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for appointment in appointments %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ appointment.doctor.full_name }}</td>
          <td>{{ appointment.appointment_date }}</td>
          <td>{{ appointment.symptoms }}</td>
          <td>{{ appointment.get_status_display }}</td>
          <td>
            <a href="{% url 'administrations:appointment-detail' appointment.pk %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-eye"></i></a>
            {% if user.user_type == 0  %}
              <a href="{% url 'administrations:appointment-update' appointment.pk %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-edit"></i></a>
              <a href="{% url 'administrations:appointment-delete' appointment.pk %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-trash"></i></a>
            {% endif %}
          </td>
        </tr>
      {% empty %}
          <tr>
            <td colspan="5">No appointment available.</td>
          </tr>
      {% endfor %}
    </tbody>
  </table>
    
    <!-- Display patient's prescriptions -->
     <h2>Prescriptions</h2>
    <table class="table">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Doctor</th>
        <th scope="col">Issue Date</th>
        <th scope="col">Next Appointment Date</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for prescription in prescriptions %}
        <tr>
          <th scope="row">{{ forloop.counter }}</th>
          <td>{{ prescription.doctor }}</td>
          <td>{{ prescription.issue_date }}</td>
          <td>{{ prescription.next_appointment_date }}</td>
          <td>
            <a href="{% url 'administrations:prescription-detail' prescription_id=prescription.id %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-eye"></i></a>
            {% if user.user_type == 0  %}
            <a href="{% url 'administrations:edit-prescription' prescription_id=prescription.id %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-edit"></i></a>
            <a href="{% url 'administrations:delete-prescription' prescription_id=prescription.id %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-trash"></i></a>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="6">No prescriptions available.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
    
    <!-- Display patient's medical reports -->
    <h2>Medical Reports</h2>
<table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>Test Name</th>
          <th>Test Date</th>
          <th>Delivery Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for medical_report in medical_reports %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ medical_report.test_name }}</td>
            <td>{{ medical_report.test_date }}</td>
            <td>{{ medical_report.delivery_date }}</td>
            <td>{{ medical_report.report_date }}</td>
            <td>
            <a href="{% url 'administrations:medical-report-detail' report_id=medical_report.id %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-eye"></i></a>
            {% if user.user_type == 0  %}
            <a href="{% url 'administrations:edit-medical-report' report_id=medical_report.id %}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-edit"></i></a>
            <a href="{% url 'administrations:delete-medical-report' report_id=medical_report.id%}" class="btn btn-circle p-0 m-1 position-relative"><i class="fas fa-trash"></i></a>
            {% endif %}
          </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="5">No medical reports available.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    
    {% comment %} <a href="{% url 'patient:patient-update' patient.pk %}" class="btn btn-warning">Edit</a>
    <a href="{% url 'patient:patient-delete' patient.pk %}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this patient?')">Delete</a>
    <a href="{% url 'patient:patient-list' %}" class="btn btn-secondary">Back to Patient List</a> {% endcomment %}
  
  </div>
<link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
{% endblock %}
